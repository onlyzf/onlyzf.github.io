{"componentChunkName":"component---src-templates-blog-post-js","path":"/snippets/supervisor/","result":{"data":{"site":{"siteMetadata":{"title":"Fan's life"}},"markdownRemark":{"id":"8e1a026b-053d-53e8-9bc7-007216512209","excerpt":"Supervisor is a client/server system that allows its users to monitor and control a number of processes on UNIX-like operating systems. Supervisor…","html":"<p>Supervisor is a client/server system that allows its users to monitor and control a number of processes on UNIX-like operating systems.</p>\n<p>Supervisor 是比较简单的创建守护进程的工具，支持 linux 和 macOS 这些类 UNIX 系统。\n它的优势在于比较轻量、不需要 root 权限、配置简单、跨平台。开发时比较好用。</p>\n<p>Supervisor 主要有 supervisord 和 supervisorctl，分别是服务和控制台工具。</p>\n<p>详细文档参见：<a href=\"http://supervisord.org/\">Supervisor</a></p>\n<h2>最简 supervisord.conf</h2>\n<p>Environment variables that are present in the environment at the time that supervisord is started can be used in the configuration file using the Python string expression syntax %(ENV<em>X)s.\nsupervisord 启动时的系统环境变量 X 用%(ENV</em>X)s 可以取到。</p>\n<p><a href=\"http://supervisord.org/configuration.html\">Configuration File</a></p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token comment\">; supervisord.conf</span>\n<span class=\"token selector\">[include]</span>\n<span class=\"token comment\">; A space-separated sequence of file globs. Each file glob may be absolute or relative.</span>\n<span class=\"token comment\">; 这里配置的files是包含本地目录所有.conf.sample的文件，也就是每个服务可以单独建一个service.conf.sample</span>\n<span class=\"token comment\">; service.conf.sample见后</span>\n<span class=\"token constant\">files</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> %(ENV_PWD)s/*.conf.sample</span>\n\n<span class=\"token comment\">; The [rpcinterface:supervisor] section must remain in the configuration for the standard setup of supervisor to work properly.</span>\n<span class=\"token selector\">[rpcinterface:supervisor]</span>\n<span class=\"token constant\">supervisor.rpcinterface_factory</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> supervisor.rpcinterface:make_main_rpcinterface</span>\n\n<span class=\"token comment\">; The configuration file may contain settings for the supervisorctl interactive shell program.</span>\n<span class=\"token selector\">[supervisorctl]</span>\n<span class=\"token comment\">; The URL that should be used to access the supervisord server, e.g. http://localhost:9001. For UNIX domain sockets, use unix:///absolute/path/to/file.sock.</span>\n<span class=\"token comment\">; supervisorctl连接supervisord的URL</span>\n<span class=\"token constant\">serverurl</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> unix:///tmp/supervisor.sock</span>\n\n<span class=\"token comment\">; The supervisord.conf file contains a section named [supervisord] in which global settings related to the supervisord process should be inserted. These are as follows.</span>\n<span class=\"token selector\">[supervisord]</span>\n<span class=\"token comment\">; When supervisord daemonizes, switch to this directory. This option can include the value %(here)s, which expands to the directory in which the supervisord configuration file was found.</span>\n<span class=\"token comment\">; supervisord切换至conf文件所在目录运行</span>\n<span class=\"token constant\">directory</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> %(here)s</span>\n\n<span class=\"token comment\">; The supervisord.conf file contains a section named [unix_http_server] under which configuration parameters for an HTTP server that listens on a UNIX domain socket should be inserted. If the configuration file has no [unix_http_server] section, a UNIX domain socket HTTP server will not be started.</span>\n<span class=\"token selector\">[unix_http_server]</span>\n<span class=\"token comment\">; A path to a UNIX domain socket (e.g. /tmp/supervisord.sock) on which supervisor will listen for HTTP/XML-RPC requests. supervisorctl uses XML-RPC to communicate with supervisord over this port.</span>\n<span class=\"token comment\">; supervisord监听的socket，supervisorctl需要连接此socket才能控制supervisord</span>\n<span class=\"token constant\">file</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> /tmp/supervisor.sock</span></code></pre></div>\n<h2>最简 service.conf.sample</h2>\n<p><a href=\"http://supervisord.org/configuration.html#program-x-section-settings\">[program:x] Section Settings</a></p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\"><span class=\"token comment\">; service.conf.sample</span>\n<span class=\"token comment\">; The configuration file must contain one or more program sections in order for supervisord to know which programs it should start and control. The header value is composite value. It is the word “program”, followed directly by a colon, then the program name.</span>\n<span class=\"token selector\">[program:service]</span>\n<span class=\"token comment\">; The command that will be run when this program is started. The command can be either absolute (e.g. /path/to/programname) or relative (e.g. programname). If it is relative, the supervisord’s environment $PATH will be searched for the executable.</span>\n<span class=\"token constant\">command</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>%(ENV_PWD)s/service --port=8000</span>\n<span class=\"token comment\">; A list of key/value pairs in the form KEY=\"val\",KEY2=\"val2\" that will be placed in the child process’ environment.</span>\n<span class=\"token comment\">; 这里的配置是将子进程的时区设为UTC 0时区</span>\n<span class=\"token constant\">environment</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>TZ=\"UTC\"</span></code></pre></div>","frontmatter":{"title":"极简Supervisor","date":"October 19, 2018","description":null}},"previous":{"fields":{"slug":"/snippets/git/"},"frontmatter":{"title":"Git snippets"}},"next":{"fields":{"slug":"/snippets/dns/"},"frontmatter":{"title":"DNS"}}},"pageContext":{"id":"8e1a026b-053d-53e8-9bc7-007216512209","previousPostId":"264acf3e-6d58-5ef3-bcd7-8d1fffc03fb2","nextPostId":"d41f078e-f064-56a9-bbb3-fc7bd9940b25"}},"staticQueryHashes":["2841359383","916993862"]}